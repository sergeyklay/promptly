-- This file is part of the Promptly.
--
-- Copyright (C) 2023 Serghei Iakovlev <egrep@protonmail.ch>
--
-- For the full copyright and license information, please view
-- the LICENSE file that was distributed with this source code.

-----------------------------------------------------------------------
-- !!! BACKUP YOUR dev-db.sqlite3 BEFORE RUNNING THIS SQL SCRIPT !!! --
-- ...as it will simply delete all data.                             --
--                                                                   --
-- USAGE (Unix/Bash):                                                --
--   sqlite3 dev-db.sqlite3 < migrations/db-clean.sqlite3            --
-----------------------------------------------------------------------

--
-- TODO: UPDATE SQLITE_SEQUENCE SET seq = 0 WHERE name = ???;
--

PRAGMA foreign_keys = OFF;

DELETE FROM chats;
DELETE FROM chat_entries;
DELETE FROM prompts;
DELETE FROM prompt_references;
DELETE FROM prompt_criteria;

-----------------------------------------------------------------------
-- Post-cleanup maintenance                                          --
-----------------------------------------------------------------------

-- Rebuild the entire database file
-- https://www.sqlite.org/lang_vacuum.html
VACUUM;

-- Update statistics for the query planner
-- https://www.sqlite.org/lang_analyze.html
ANALYZE;
